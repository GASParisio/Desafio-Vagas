<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ’» Portal de Vagas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="estilo.css">
    
    <script src="https://js.hcaptcha.com/1/api.js" async defer></script>
</head>

<body>
    <nav class="menu">
        <ul>
            <li><a href="index.html">InÃ­cio</a></li>
            <li><a href="novousuario.html">Criar Conta</a></li>
            <li><a href="vagas.html">Vagas</a></li>
        </ul>
    </nav>

    <div class="auth-wrapper">
        <div class="text-center mb-4">
            <h1 class="fw-bold text-primary">ðŸ’¼ Portal de Vagas</h1>
            <p class="text-muted">Encontre sua prÃ³xima oportunidade</p>
        </div>

        <div class="card auth-card p-4">
            <div class="card-body">
                <h4 class="text-center mb-4">Acesse sua conta</h4>
                
                <form id="login-form">
                    <div class="mb-3">
                        <label for="email" class="form-label text-muted small fw-bold">E-MAIL</label>
                        <input type="email" class="form-control" id="email" placeholder="nome@exemplo.com" autofocus/>
                    </div>
                    <div class="mb-3">
                        <label for="senha" class="form-label text-muted small fw-bold">SENHA</label>
                        <input type="password" class="form-control" id="senha" placeholder="Sua senha secreta"/>
                    </div>

                    <div class="my-3 d-flex justify-content-center">
                        <div class="h-captcha" data-sitekey="6d868efe-3b02-4ec0-b21a-1a122240ea22"></div>
                    </div>

                    <div class="d-grid gap-2"> 
                        <button type="submit" class="btn btn-primary btn-lg">Entrar</button>
                    </div>
                </form>
            </div>
            <div class="card-footer bg-white text-center border-0 mt-3">
                <small>NÃ£o tem uma conta? <a href="novousuario.html" class="text-decoration-none fw-bold">Cadastre-se</a></small>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
        const urlSupabase = 'https://htoeymqqwaliexijmyei.supabase.co'
        const anon = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh0b2V5bXFxd2FsaWV4aWpteWVpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU2MDg0NTAsImV4cCI6MjA4MTE4NDQ1MH0.Fweb9NFy6stz8TfM-FLlDZUoC9N_A-2WV-ji0RxfJQU'

        const client = supabase.createClient(urlSupabase, anon)
        const formLogin = document.getElementById('login-form');

        formLogin.addEventListener('submit', async (event) => {
            event.preventDefault()
            
            const emailValue = document.getElementById('email').value
            const senhaValue = document.getElementById('senha').value
            
            const captchaToken = hcaptcha.getResponse();

            if(!emailValue || !senhaValue) {
                alert("Preencha e-mail e senha!");
                return;
            }

            if (!captchaToken) {
                alert("Por favor, confirme que vocÃª nÃ£o Ã© um robÃ´.");
                return;
            }

            try {
                const { data, error } = await client.auth.signInWithPassword({
                    email: emailValue, 
                    password: senhaValue,
                    options: { 
                        captchaToken: captchaToken 
                    }
                })

                if (error) {
                    alert('Erro: ' + error.message)
                    hcaptcha.reset(); 
                } else {
                    localStorage.setItem('session', JSON.stringify(data.session))
                    window.location.href = 'vagas.html'
                }
            } catch (err) {
                console.error("Erro inesperado:", err)
            }
        })
    </script> 
</body>
</html>